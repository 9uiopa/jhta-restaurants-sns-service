<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.jhta.restaurants_service.mapper.OtpMapper">
    <insert id="insert" parameterType="Otp">
        <selectKey keyProperty="id" resultType="int" order="AFTER">
            SELECT LAST_INSERT_ID()
        </selectKey>
        insert into OTP (
            EMAIL, OTP_CODE
        ) values (
            #{email}, #{otpCode}
        )
    </insert>

    <select id="findByEmail" parameterType="string" resultType="Otp">
        select
            ID as id,
            EMAIL as email,
            OTP_CODE as otpCode,
            CREATE_DATE as createDate
        from
            OTP
        where
            EMAIL = #{value}
    </select>

    <update id="update" parameterType="Otp">
        update
            OTP
        set
            OTP_CODE = #{otpCode}
            CREATE_DATE = #{createDate}
        where
            ID = #{id}
    </update>

    <delete id="delete" parameterType="Otp">
        delete from
            OTP
        where
            ID = #{id}
    </delete>

    <select id="validateByEmail" parameterType="Otp" resultType="boolean">
        select
            exists (
                select
                    1
                from
                    OTP
                where
                    OTP_CODE = #{otpCode} AND EMAIL = #{email}
            )
    </select>
</mapper>