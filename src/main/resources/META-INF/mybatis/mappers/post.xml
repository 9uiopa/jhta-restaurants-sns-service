<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.jhta.restaurants_service.mapper.PostMapper">

	<select id="getAllPost" resultType="Post">
		select 
			id				as id,
			title			as title,
			sub_title		as subTitle,
			create_date		as createDate,
			update_date		as updateDate,
			user_id			as "customer.id",
			report_count	as reportCount,
			disabled		as disabled,
			blocked			as blocked
		from
			post
		order by id asc	
	</select>
	
	<select id="getPostById" parameterType="int" resultType="Post">
		select 
			id				as id,
			title			as title,
			sub_title		as subTitle,
			content			as content,
			create_date		as createDate,
			update_date		as updateDate,
			user_id			as "customer.id",
			report_count	as reportCount,
			disabled		as disabled,
			blocked			as blocked
		from
			post
		where	
			id = #{id}
	</select>
	
	<insert id="insertPost" parameterType="Post">
		<selectKey keyProperty="id" resultType="int" order="AFTER">
            SELECT LAST_INSERT_ID()
        </selectKey>
		insert into POSTS
		(title, sub_title)
		values
		(#{title}, #{subTitle})
	</insert>
	
	<insert id="insertPostData" parameterType="kr.co.jhta.restaurants_service.vo.post.PostData">
	    INSERT INTO POST_DATA
	    (post_id, store_id, content, picture_file) 
	    VALUES 
	    (#{post.id}, #{store.id}, #{content}, #{pictureFile})
	</insert>
	
	<update id="updatePost" parameterType="int">
		update
            post
        set
            title = #{title},
            sub_title = #{subTitle},
            update_date = #{updateDate},
            report_count = #{reportCount},
            disabled = #{disabled},
            blocked = #{blocked}
        where
            id = #{id}
	</update>
	
	<delete id="deletePost" parameterType="int">
		delete from 
			post
		where 
			id = #{id}
	</delete>
	
</mapper>