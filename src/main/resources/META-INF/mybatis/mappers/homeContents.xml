<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.jhta.restaurants_service.mapper.HomeMapper">
	
	<select id="" parameterType="int" resultType="HomeContent">
		select 
			*,
			ROW_NUMBER() OVER (ORDER BY createDate desc) as id
		from
			(select
				R.id			as id,
				R.id			as "review.id",
				NULL			as "post.id",
				U.username		as username, 
				content			as content,
				NULL			as title,
				R.create_date	as createDate,
				S.name			as storeName,
				S.category		as category,
				S.address		as address
			from REVIEWS R
			join USERS U on R.customer_id = U.id
			join STORES S on R.store_id = S.id
			join FOLLOWS F on R.customer_id = F.followed_id and 86 = F.follower_id
			
			union
				
			select
				P.id			as id,
				NULL			as "review.id",
				P.id			as "post.id",
				U.username		as username, 
				content			as content,
				P.title			as title,
				P.create_date	as createDate,
				S.name			as storeName,
				S.category		as category,
				S.address		as address
			from POSTS P
			join USERS U on P.customer_id = U.id
			join POST_DATA PD on P.id = PD.post_id
			join STORES S on PD.store_id = S.id
			join FOLLOWS F on P.customer_id = F.followed_id and 86 = F.follower_id) as subquery
		limit 0, 5
	</select>

</mapper>